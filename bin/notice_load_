#!/usr/bin/env ruby

BASE_DIR = File.expand_path(File.dirname(__FILE__) + '/..')

command = "gdb --batch -x #{BASE_DIR}/scripts/notice_load.gdb #{ARGV.join(' ')} 2>&1"
IO.popen(command, 'r') do |io|
  while line = io.gets
    if line[/^>>\[rb_load_file\] *0x[0-9a-f]+ *"(.*)"$/]
      puts $1
    end
  end
end
